# ğŸ“š Dokumentasi: Refactoring Callback ke Promise

> **Dokumentasi Pribadi untuk Pemula** ğŸŒ±  
> Belajar mengubah callback menjadi Promise untuk menangani kode asynchronous dengan lebih baik

---

## ğŸ“‘ Daftar Isi

- [Pengenalan](#pengenalan)
- [Masalah dengan Callback](#masalah-dengan-callback)
- [Setup File HTML & CSS](#setup-file-html-css)
- [Kode Awal dengan Callback](#kode-awal-dengan-callback)
- [Cara Kerja Kode Callback](#cara-kerja-kode-callback)
- [Refactoring ke Promise](#refactoring-ke-promise)
  - [Langkah 1: Hapus Parameter Callback](#langkah-1-hapus-parameter-callback)
  - [Langkah 2: Buat Promise](#langkah-2-buat-promise)
  - [Langkah 3: Gunakan .then()](#langkah-3-gunakan-then)
- [Menambahkan Error Handling](#menambahkan-error-handling)
  - [Simulasi Error](#simulasi-error)
  - [Fungsi showError](#fungsi-showerror)
  - [Menggunakan .catch()](#menggunakan-catch)
- [Kesimpulan](#kesimpulan)

---

<a name="pengenalan"></a>
## ğŸ¯ Pengenalan

Dokumentasi ini membahas tentang **refactoring** (mengubah struktur kode) dari menggunakan **callback** menjadi **Promise**. Keduanya adalah cara untuk menangani kode asynchronous (kode yang tidak langsung selesai dijalankan).

**Yang akan kita pelajari:**
- âœ… Cara kerja callback
- âœ… Mengubah callback menjadi Promise
- âœ… Menggunakan `.then()` untuk menangani Promise
- âœ… Menggunakan `.catch()` untuk menangani error

---

<a name="masalah-dengan-callback"></a>
## âš ï¸ Masalah dengan Callback

**Situasi Awal:**

Kita punya array `posts` dengan 2 post. Kemudian ada 2 fungsi:
- `createPost()` - menambah post baru (butuh **2 detik**)
- `getPosts()` - menampilkan semua post (butuh **1 detik**)

**Masalah yang terjadi:**

Ketika kita memanggil `createPost()` lalu `getPosts()`, yang terjadi adalah:
1. `createPost()` mulai berjalan (2 detik)
2. `getPosts()` mulai berjalan (1 detik)
3. `getPosts()` **selesai duluan** â†’ hanya menampilkan 2 post lama
4. `createPost()` baru selesai â†’ post ketiga tidak muncul!

**Solusi Callback:**

Kita pass `getPosts` sebagai callback ke dalam `createPost()`, sehingga `getPosts()` baru dijalankan **setelah** `createPost()` selesai.

---

<a name="setup-file-html-css"></a>
## ğŸ“„ Setup File HTML & CSS

### File: `index.html`

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>Callback to Promise Refactor</title>
  </head>
  <body>
    <h1>Callback to Promise Refactor</h1>

    <div id="posts"></div>

    <script src="./script.js"></script>
  </body>
</html>
```

**Penjelasan:**
- Ada `<div id="posts">` untuk menampilkan semua post
- File CSS dan JavaScript di-link di sini

---

### File: `style.css`

```css
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

*,
*:before,
*:after {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

body {
  font-family: 'Poppins';
  line-height: 1.6;
  padding: 0 40px;
}

h1 {
  text-align: center;
  line-height: 1.3;
  margin-top: 20px;
}

h3 {
  text-align: center;
  font-size: 20px;
}

#posts {
  margin-top: 20px;
}

#posts div {
  list-style: none;
  background: #f4f4f4;
  margin-bottom: 5px;
  padding: 5px;
}
```

**Penjelasan:**
- Styling sederhana untuk tampilan yang rapi
- Menggunakan font Poppins dari Google Fonts
- Post ditampilkan dengan background abu-abu

---

<a name="kode-awal-dengan-callback"></a>
## ğŸ“ Kode Awal dengan Callback

### File: `script.js` (Versi Callback)

```javascript
const posts = [
  { title: 'Post One', body: 'This is post one' },
  { title: 'Post Two', body: 'This is post two' },
];

function createPost(post, cb) {
  setTimeout(() => {
    posts.push(post);
    cb();
  }, 2000);
}

function getPosts() {
  setTimeout(() => {
    posts.forEach(function (post) {
      const div = document.createElement('div');
      div.innerHTML = `<strong>${post.title}</strong> - ${post.body}`;
      document.querySelector('#posts').appendChild(div);
    });
  }, 1000);
}

createPost({ title: 'Post Three', body: 'This is post' }, getPosts);
```

---

<a name="cara-kerja-kode-callback"></a>
## ğŸ” Cara Kerja Kode Callback

### 1ï¸âƒ£ **Array Posts**
```javascript
const posts = [
  { title: 'Post One', body: 'This is post one' },
  { title: 'Post Two', body: 'This is post two' },
];
```
Array yang menyimpan data post.

---

### 2ï¸âƒ£ **Fungsi createPost()**
```javascript
function createPost(post, cb) {
  setTimeout(() => {
    posts.push(post);
    cb();
  }, 2000);
}
```

**Penjelasan:**
- Menerima 2 parameter: `post` (data post baru) dan `cb` (callback function)
- `setTimeout()` menunda eksekusi **2 detik** (simulasi operasi async)
- Setelah 2 detik: push post baru ke array, lalu panggil callback `cb()`

---

### 3ï¸âƒ£ **Fungsi getPosts()**
```javascript
function getPosts() {
  setTimeout(() => {
    posts.forEach(function (post) {
      const div = document.createElement('div');
      div.innerHTML = `<strong>${post.title}</strong> - ${post.body}`;
      document.querySelector('#posts').appendChild(div);
    });
  }, 1000);
}
```

**Penjelasan:**
- `setTimeout()` menunda eksekusi **1 detik**
- Loop semua post dengan `forEach()`
- Buat element `<div>` untuk setiap post
- Isi dengan title dan body post
- Tambahkan ke dalam `#posts` di HTML

---

### 4ï¸âƒ£ **Memanggil Fungsi**
```javascript
createPost({ title: 'Post Three', body: 'This is post' }, getPosts);
```

**Penjelasan:**
- Panggil `createPost()` dengan post baru
- Pass `getPosts` sebagai callback
- `getPosts` akan dijalankan **setelah** `createPost` selesai

---

<a name="refactoring-ke-promise"></a>
## ğŸ”„ Refactoring ke Promise

Sekarang kita akan mengubah callback menjadi Promise!

---

<a name="langkah-1-hapus-parameter-callback"></a>
### Langkah 1: Hapus Parameter Callback âŒ

**Sebelum:**
```javascript
function createPost(post, cb) {
  setTimeout(() => {
    posts.push(post);
    cb(); // â† hapus ini
  }, 2000);
}
```

**Sesudah:**
```javascript
function createPost(post) { // â† hapus parameter cb
  // kode di sini akan berubah
}
```

**Penjelasan:**
Kita tidak butuh parameter `cb` lagi karena akan menggunakan Promise.

---

<a name="langkah-2-buat-promise"></a>
### Langkah 2: Buat Promise âœ¨

```javascript
function createPost(post) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      posts.push(post);
      resolve();
    }, 2000);
  });
}
```

**Penjelasan Detail:**

ğŸ”¹ **`return new Promise()`**
- Promise adalah object yang merepresentasikan hasil operasi async
- Kita `return` Promise agar bisa di-handle di luar fungsi

ğŸ”¹ **`(resolve, reject) => {}`**
- Promise menerima **function** dengan 2 parameter:
  - `resolve`: dipanggil jika berhasil
  - `reject`: dipanggil jika error

ğŸ”¹ **`resolve()`**
- Setelah push post, panggil `resolve()` untuk menandakan Promise berhasil
- Tidak ada callback lagi!

---

<a name="langkah-3-gunakan-then"></a>
### Langkah 3: Gunakan .then() ğŸ‰

**Sebelum (Callback):**
```javascript
createPost({ title: 'Post Three', body: 'This is post' }, getPosts);
```

**Sesudah (Promise):**
```javascript
createPost({ title: 'Post Three', body: 'This is post' })
  .then(getPosts);
```

**Penjelasan:**

ğŸ”¹ **`.then()`**
- Cara untuk handle Promise
- Function di dalam `.then()` akan dijalankan **setelah** Promise `resolve()`
- Dalam kasus ini, `getPosts` akan jalan setelah `createPost` selesai

**Hasil:** Post Three akan muncul bersama Post One dan Post Two! ğŸŠ

---

<a name="menambahkan-error-handling"></a>
## âš¡ Menambahkan Error Handling

Sekarang kita akan simulasikan error dan cara menanganinya!

---

<a name="simulasi-error"></a>
### Simulasi Error ğŸ”´

Ubah fungsi `createPost()`:

```javascript
function createPost(post) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      let error = false; // â† variable untuk simulasi

      if (!error) {
        posts.push(post);
        resolve();
      } else {
        reject('Something went wrong'); // â† reject jika error
      }
    }, 2000);
  });
}
```

**Penjelasan:**

ğŸ”¹ **`let error = false`**
- Variable untuk simulasi error
- `false` = tidak ada error (kode berjalan normal)
- `true` = ada error (akan trigger reject)

ğŸ”¹ **`if (!error)`**
- Jika TIDAK ada error â†’ push post dan `resolve()`

ğŸ”¹ **`else`**
- Jika ada error â†’ panggil `reject()` dengan pesan error

---

<a name="fungsi-showerror"></a>
### Fungsi showError() ğŸš¨

Buat fungsi baru untuk menampilkan error:

```javascript
function showError(error) {
  const h3 = document.createElement('h3');
  h3.innerHTML = `<strong>${error}</strong>`;
  document.getElementById('posts').appendChild(h3);
}
```

**Penjelasan:**

ğŸ”¹ **Parameter `error`**
- Menerima pesan error dari `reject()`

ğŸ”¹ **`document.createElement('h3')`**
- Buat element `<h3>` untuk menampilkan error

ğŸ”¹ **`h3.innerHTML`**
- Isi dengan pesan error dalam tag `<strong>`

ğŸ”¹ **`appendChild(h3)`**
- Tambahkan ke `#posts` di HTML

---

<a name="menggunakan-catch"></a>
### Menggunakan .catch() ğŸ¯

```javascript
createPost({ title: 'Post Three', body: 'This is post' })
  .then(getPosts)
  .catch(showError);
```

**Penjelasan:**

ğŸ”¹ **`.catch()`**
- Cara untuk handle error dari Promise
- Akan jalan jika Promise di-`reject()`
- Dalam kasus ini, `showError` akan menerima pesan error

**Testing:**

1. **Error = false** â†’ Post muncul normal âœ…
2. **Error = true** â†’ Pesan "Something went wrong" muncul âŒ

---

## ğŸ“Š Perbandingan Callback vs Promise

| Aspek | Callback | Promise |
|-------|----------|---------|
| **Syntax** | `function(param, cb)` | `return new Promise()` |
| **Handle Result** | Panggil `cb()` | Panggil `resolve()` |
| **Handle Error** | Manual | Gunakan `reject()` |
| **Cara Pakai** | Pass function sebagai parameter | `.then()` dan `.catch()` |
| **Readability** | Kurang jelas (nested callback) | Lebih jelas (chaining) |

---

<a name="kesimpulan"></a>
## ğŸ“ Kesimpulan

### Hal Penting yang Dipelajari:

âœ… **Promise adalah cara modern** untuk handle kode asynchronous

âœ… **Struktur Promise:**
```javascript
return new Promise((resolve, reject) => {
  // kode async
  if (berhasil) resolve();
  else reject('error message');
});
```

âœ… **Handle Promise:**
```javascript
functionYangReturnPromise()
  .then(functionJikaBerhasil)
  .catch(functionJikaError);
```

âœ… **Keuntungan Promise:**
- Lebih mudah dibaca
- Error handling lebih baik
- Bisa di-chain (berantai)
- Menghindari "callback hell"

---

### ğŸ’¡ Tips untuk Pemula:

1. **Promise selalu return** - jangan lupa `return new Promise()`
2. **resolve() untuk sukses** - reject() untuk error
3. **.then() butuh function** - bisa named function atau anonymous
4. **.catch() untuk error** - hampir selalu gunakan ini
5. **Latihan terus** - ubah `error` jadi `true` dan `false` untuk lihat perbedaannya

---

### ğŸš€ Next Steps:

Setelah menguasai Promise, kamu bisa belajar:
- **async/await** - cara yang lebih modern lagi!
- **Promise.all()** - menjalankan banyak Promise sekaligus
- **Fetch API** - menggunakan Promise untuk HTTP request

---

**Happy Coding! ğŸ‰**

> Dokumentasi ini dibuat sebagai catatan pribadi untuk belajar JavaScript Promises step by step.
