# ğŸ“š Dokumentasi: Refactoring Callback ke Promise

> **Dokumentasi Pribadi untuk Pemula** ğŸ“  
> Belajar mengubah callback menjadi Promise secara bertahap

---

## ğŸ“‹ Daftar Isi

- [Pengenalan](#pengenalan)
- [Persiapan Project](#persiapan-project)
  - [File HTML](#file-html)
  - [File CSS](#file-css)
- [Memahami Masalah Asynchronous](#memahami-masalah-asynchronous)
- [Kode Awal dengan Callback](#kode-awal-dengan-callback)
- [Langkah-Langkah Refactoring](#langkah-langkah-refactoring)
  - [Langkah 1: Hapus Parameter Callback](#langkah-1-hapus-parameter-callback)
  - [Langkah 2: Buat Promise Baru](#langkah-2-buat-promise-baru)
  - [Langkah 3: Tambahkan Resolve](#langkah-3-tambahkan-resolve)
  - [Langkah 4: Ubah Cara Pemanggilan](#langkah-4-ubah-cara-pemanggilan)
  - [Langkah 5: Tambahkan Error Handling](#langkah-5-tambahkan-error-handling)
  - [Langkah 6: Buat Function showError](#langkah-6-buat-function-showerror)
  - [Langkah 7: Tambahkan .catch()](#langkah-7-tambahkan-catch)
- [Kode Final](#kode-final)
- [Testing](#testing)
- [Kesimpulan](#kesimpulan)

---

<a name="pengenalan"></a>
## ğŸ¯ Pengenalan

Dalam tutorial ini, kita akan belajar:
- âœ… Memahami perbedaan **Callback** dan **Promise**
- âœ… Mengubah (refactor) kode dari callback ke promise
- âœ… Menangani error dengan `.catch()`
- âœ… Membuat kode lebih mudah dibaca dan dimaintain

**Tingkat Kesulitan:** Pemula ğŸŒ±  
**Waktu Belajar:** 30-45 menit â±ï¸

---

<a name="persiapan-project"></a>
## ğŸ› ï¸ Persiapan Project

<a name="file-html"></a>
### ğŸ“„ File HTML

Buat file `index.html`:

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>Callback to Promise Refactor</title>
  </head>
  <body>
    <h1>Callback to Promise Refactor</h1>

    <div id="posts"></div>

    <script src="./script.js"></script>
  </body>
</html>
```

**Penjelasan:**
- `<div id="posts">` â†’ tempat menampilkan data posts
- `<script src="./script.js">` â†’ file JavaScript kita

---

<a name="file-css"></a>
### ğŸ¨ File CSS

Buat file `style.css`:

```css
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

*,
*:before,
*:after {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

body {
  font-family: 'Poppins';
  line-height: 1.6;
  padding: 0 40px;
}

h1 {
  text-align: center;
  line-height: 1.3;
  margin-top: 20px;
}

h3 {
  text-align: center;
  font-size: 20px;
}

#posts {
  margin-top: 20px;
}

#posts div {
  list-style: none;
  background: #f4f4f4;
  margin-bottom: 5px;
  padding: 5px;
}
```

---

<a name="memahami-masalah-asynchronous"></a>
## âš¡ Memahami Masalah Asynchronous

### ğŸ¤” Masalah yang Kita Hadapi:

Bayangkan kita punya 2 fungsi:

1. **`createPost()`** â†’ Menambah post baru (butuh **2 detik** â³)
2. **`getPosts()`** â†’ Menampilkan semua posts (butuh **1 detik** â³)

**âŒ Masalah:**
Jika kita panggil `createPost()` lalu `getPosts()`:
- `getPosts()` selesai lebih dulu (1 detik)
- Post baru belum ditambahkan (butuh 2 detik)
- **Hasilnya:** Post ketiga tidak muncul! ğŸ˜±

**âœ… Solusi:**
Kita perlu tunggu `createPost()` selesai dulu, baru panggil `getPosts()`

---

<a name="kode-awal-dengan-callback"></a>
## ğŸ“ Kode Awal dengan Callback

Buat file `script.js`:

```javascript
const posts = [
  { title: 'Post One', body: 'This is post one' },
  { title: 'Post Two', body: 'This is post two' },
];

function createPost(post, cb) {
  setTimeout(() => {
    posts.push(post);
    cb();
  }, 2000);
}

function getPosts() {
  setTimeout(() => {
    posts.forEach(function (post) {
      const div = document.createElement('div');
      div.innerHTML = `<strong>${post.title}</strong> - ${post.body}`;
      document.querySelector('#posts').appendChild(div);
    });
  }, 1000);
}

createPost({ title: 'Post Three', body: 'This is post' }, getPosts);
```

**Penjelasan Kode:**

| Bagian | Fungsi |
|--------|--------|
| `posts` | Array berisi data posts |
| `createPost(post, cb)` | Menambah post baru + jalankan callback |
| `getPosts()` | Menampilkan semua posts ke layar |
| `setTimeout()` | Simulasi proses asynchronous |

**Cara Kerja Callback:**
```
createPost() dipanggil
  â†“ (tunggu 2 detik)
  â†“ push post ke array
  â†“ panggil cb() â†’ getPosts()
  â†“ (tunggu 1 detik)
  â†“ tampilkan semua posts âœ…
```

---

<a name="langkah-langkah-refactoring"></a>
## ğŸ”„ Langkah-Langkah Refactoring

<a name="langkah-1-hapus-parameter-callback"></a>
### ğŸ“Œ Langkah 1: Hapus Parameter Callback

**Ubah dari:**
```javascript
function createPost(post, cb) {
  setTimeout(() => {
    posts.push(post);
    cb();  // â† hapus ini
  }, 2000);
}
```

**Menjadi:**
```javascript
function createPost(post) {  // â† hapus parameter cb
  setTimeout(() => {
    posts.push(post);
    // cb(); â† hapus baris ini
  }, 2000);
}
```

ğŸ’¡ **Mengapa?** Kita tidak akan pakai callback lagi, kita akan pakai Promise!

---

<a name="langkah-2-buat-promise-baru"></a>
### ğŸ“Œ Langkah 2: Buat Promise Baru

**Tambahkan Promise:**
```javascript
function createPost(post) {
  return new Promise((resolve, reject) => {
    // kode kita akan masuk di sini
  });
}
```

**Penjelasan:**
- `return new Promise()` â†’ membuat Promise baru
- `(resolve, reject)` â†’ 2 parameter:
  - `resolve` â†’ dipanggil jika **berhasil** âœ…
  - `reject` â†’ dipanggil jika **gagal** âŒ

---

<a name="langkah-3-tambahkan-resolve"></a>
### ğŸ“Œ Langkah 3: Tambahkan Resolve

**Pindahkan `setTimeout` ke dalam Promise:**
```javascript
function createPost(post) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      posts.push(post);
      resolve();  // â† panggil resolve setelah selesai
    }, 2000);
  });
}
```

ğŸ’¡ **Penting:** `resolve()` dipanggil setelah `posts.push()` untuk menandakan proses selesai!

---

<a name="langkah-4-ubah-cara-pemanggilan"></a>
### ğŸ“Œ Langkah 4: Ubah Cara Pemanggilan

**Ubah dari:**
```javascript
createPost({ title: 'Post Three', body: 'This is post' }, getPosts);
```

**Menjadi:**
```javascript
createPost({ title: 'Post Three', body: 'This is post' })
  .then(getPosts);
```

**Penjelasan:**
- `.then()` â†’ dijalankan setelah Promise selesai (resolve)
- `getPosts` â†’ fungsi yang akan dipanggil di dalam `.then()`

**Cara Kerja:**
```
createPost() dipanggil
  â†“ return Promise
  â†“ (tunggu 2 detik)
  â†“ resolve() dipanggil
  â†“ .then() dijalankan
  â†“ getPosts() dipanggil
  â†“ tampilkan posts âœ…
```

---

<a name="langkah-5-tambahkan-error-handling"></a>
### ğŸ“Œ Langkah 5: Tambahkan Error Handling

**Simulasi Error:**
```javascript
function createPost(post) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      let error = false;  // â† buat variable error
      
      if (!error) {  // â† cek jika tidak ada error
        posts.push(post);
        resolve();
      } else {  // â† jika ada error
        reject('Something went wrong');  // â† panggil reject
      }
    }, 2000);
  });
}
```

**Penjelasan:**
- `let error = false` â†’ simulasi kondisi error
- `if (!error)` â†’ jika **TIDAK** ada error, jalankan `resolve()`
- `else` â†’ jika ada error, jalankan `reject('pesan error')`

---

<a name="langkah-6-buat-function-showerror"></a>
### ğŸ“Œ Langkah 6: Buat Function showError

**Tambahkan fungsi baru:**
```javascript
function showError(error) {
  const h3 = document.createElement('h3');
  h3.innerHTML = `<strong>${error}</strong>`;
  document.getElementById('posts').appendChild(h3);
}
```

**Penjelasan Langkah demi Langkah:**

1. **Buat elemen h3:**
   ```javascript
   const h3 = document.createElement('h3');
   ```

2. **Isi dengan pesan error:**
   ```javascript
   h3.innerHTML = `<strong>${error}</strong>`;
   ```
   - `${error}` â†’ menampilkan pesan error yang diterima

3. **Tambahkan ke DOM:**
   ```javascript
   document.getElementById('posts').appendChild(h3);
   ```
   - Menambahkan h3 ke dalam div dengan id="posts"

---

<a name="langkah-7-tambahkan-catch"></a>
### ğŸ“Œ Langkah 7: Tambahkan .catch()

**Ubah pemanggilan function:**
```javascript
createPost({ title: 'Post Three', body: 'This is post' })
  .then(getPosts)
  .catch(showError);  // â† tambahkan .catch()
```

**Penjelasan:**
- `.catch(showError)` â†’ menangkap error dari `reject()`
- Jika ada error, `showError()` akan dipanggil

**Alur Lengkap:**
```
createPost() dipanggil
  â†“
  â”œâ”€ Jika BERHASIL (resolve)
  â”‚    â†“ .then(getPosts)
  â”‚    â†“ tampilkan posts âœ…
  â”‚
  â””â”€ Jika GAGAL (reject)
       â†“ .catch(showError)
       â†“ tampilkan error âŒ
```

---

<a name="kode-final"></a>
## âœ… Kode Final

```javascript
const posts = [
  { title: 'Post One', body: 'This is post one' },
  { title: 'Post Two', body: 'This is post two' },
];

function createPost(post) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      let error = false;

      if (!error) {
        posts.push(post);
        resolve();
      } else {
        reject('Something went wrong');
      }
    }, 2000);
  });
}

function getPosts() {
  setTimeout(() => {
    posts.forEach(function (post) {
      const div = document.createElement('div');
      div.innerHTML = `<strong>${post.title}</strong> - ${post.body}`;
      document.querySelector('#posts').appendChild(div);
    });
  }, 1000);
}

function showError(error) {
  const h3 = document.createElement('h3');
  h3.innerHTML = `<strong>${error}</strong>`;
  document.getElementById('posts').appendChild(h3);
}

createPost({ title: 'Post Three', body: 'This is post' })
  .then(getPosts)
  .catch(showError);
```

---

<a name="testing"></a>
## ğŸ§ª Testing

### Test 1: Kondisi Normal (No Error)

**Set:** `let error = false;`

**Hasil yang diharapkan:**
```
Post One - This is post one
Post Two - This is post two
Post Three - This is post  â† muncul setelah 2 detik
```

âœ… **Berhasil!** Semua post tampil dengan urutan yang benar.

---

### Test 2: Kondisi Error

**Set:** `let error = true;`

**Hasil yang diharapkan:**
```
Something went wrong  â† tampil setelah 2 detik
```

âœ… **Berhasil!** Error tertangkap dan ditampilkan.

---

<a name="kesimpulan"></a>
## ğŸ“ Kesimpulan

### ğŸ“Š Perbandingan Callback vs Promise

| Aspek | Callback | Promise |
|-------|----------|---------|
| **Sintaks** | `function(data, cb)` | `function().then()` |
| **Error Handling** | Manual | `.catch()` |
| **Readability** | Susah (callback hell) | Lebih mudah dibaca |
| **Chaining** | Sulit | Mudah dengan `.then()` |

---

### ğŸ¯ Poin Penting yang Dipelajari

1. **Promise Basics**
   - Promise memiliki 3 state: pending, fulfilled, rejected
   - `resolve()` untuk sukses
   - `reject()` untuk error

2. **Handling Promise**
   - `.then()` untuk menangani hasil sukses
   - `.catch()` untuk menangani error

3. **Keuntungan Promise**
   - Kode lebih clean dan mudah dibaca
   - Error handling lebih baik
   - Mudah untuk di-chain (berantai)

---

### ğŸš€ Langkah Selanjutnya

Setelah memahami Promise, kamu bisa belajar:
- **Async/Await** â†’ cara modern menulis Promise
- **Promise.all()** â†’ menjalankan banyak Promise sekaligus
- **Fetch API** â†’ menggunakan Promise untuk HTTP request

---

### ğŸ’¡ Tips untuk Pemula

1. **Praktek Bertahap**
   - Mulai dengan kode callback yang sudah jadi
   - Refactor sedikit demi sedikit
   - Test setiap perubahan

2. **Debugging**
   - Gunakan `console.log()` di dalam Promise
   - Cek apakah `resolve()` atau `reject()` terpanggil

3. **Eksplorasi**
   - Coba ubah waktu `setTimeout()`
   - Tambah lebih banyak posts
   - Buat kondisi error yang berbeda

---

### ğŸ“š Resources

- [MDN: Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)
- [JavaScript.info: Promises](https://javascript.info/promise-basics)

---

**Happy Coding! ğŸ‰**

*Dokumentasi dibuat untuk pembelajaran pribadi*
