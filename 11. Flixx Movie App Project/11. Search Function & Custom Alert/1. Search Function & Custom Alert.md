# üé¨ Dokumentasi Search Functionality - Movie App

> üìö Dokumentasi ini menjelaskan cara membuat fitur pencarian (search) untuk aplikasi movie dengan mengambil data dari URL query string dan melakukan request ke API.

---

## üìë Daftar Isi

- [Pengenalan](#pengenalan)
- [Konsep URL Query String](#konsep-url-query-string)
- [Setup Global State untuk Search](#setup-global-state-untuk-search)
- [Membuat Fungsi Search](#membuat-fungsi-search)
- [Mengambil Data dari URL](#mengambil-data-dari-url)
- [Membuat Custom Alert](#membuat-custom-alert)
- [Validasi Input Search](#validasi-input-search)
- [Memindahkan API Key ke Global State](#memindahkan-api-key-ke-global-state)
- [Membuat Fungsi searchAPIData](#membuat-fungsi-searchapidata)
- [Testing Hasil Search](#testing-hasil-search)
- [Kode Lengkap](#kode-lengkap)

---

<a name="pengenalan"></a>
## üéØ Pengenalan

Dalam tutorial ini, kita akan membuat fitur pencarian untuk movie dan TV shows. Ketika user submit form pencarian, mereka akan diarahkan ke halaman `search.html` dengan query parameters di URL. Kemudian kita akan membaca query parameters tersebut dan melakukan API request untuk menampilkan hasil pencarian.

**Cara Kerja:**
1. ‚úÖ User mengisi form search di `index.html`
2. ‚úÖ Form akan submit ke `search.html` dengan data di URL query string
3. ‚úÖ Fungsi `search()` akan otomatis dipanggil saat halaman `search.html` dimuat
4. ‚úÖ Data dari URL akan dibaca menggunakan `URLSearchParams`
5. ‚úÖ Request ke API dilakukan dengan endpoint search
6. ‚úÖ Hasil ditampilkan di DOM

---

<a name="konsep-url-query-string"></a>
## üîó Konsep URL Query String

### Apa itu Query String?

Query string adalah bagian dari URL yang dimulai dengan tanda `?` dan berisi data dalam format `key=value`.

**Contoh URL dengan Query String:**
```
http://localhost/search.html?type=movie&search-term=goodfellas
```

**Penjelasan:**
- `?` ‚Üí Penanda awal query string
- `type=movie` ‚Üí Query parameter pertama
- `&` ‚Üí Pemisah antar parameter
- `search-term=goodfellas` ‚Üí Query parameter kedua

### Kenapa Menggunakan GET Request?

Pada form HTML di `index.html`, kita tidak menggunakan `method="POST"` melainkan default `GET`. Dengan GET request:
- ‚úÖ Data form akan ditambahkan ke URL sebagai query string
- ‚úÖ User bisa bookmark atau share URL hasil pencarian
- ‚úÖ Data mudah dibaca dari URL menggunakan JavaScript

---

<a name="setup-global-state-untuk-search"></a>
## üóÇÔ∏è Setup Global State untuk Search

### Mengapa Perlu Global State?

Kita perlu menyimpan data search di global state agar bisa diakses dari fungsi manapun, terutama untuk:
- Term pencarian (apa yang user cari)
- Type pencarian (movie atau TV show)
- Pagination (halaman berapa)
- Total pages (total halaman hasil)

### ‚ú® Menambahkan Search Object ke Global State

**Kode Awal (Sebelum):**
```javascript
const global = {
  currentPage: window.location.pathname,
};
```

**Kode Baru (Sesudah):** üéâ
```javascript
const global = {
  currentPage: window.location.pathname,
  // ‚ú® TAMBAHAN BARU
  search: {
    term: '',        // Kata kunci pencarian
    type: '',        // movie atau tv
    page: 1,         // Halaman saat ini
    totalPages: 1,   // Total halaman hasil
  },
};
```

**Penjelasan:**
- `term` ‚Üí Menyimpan kata kunci yang user cari (misalnya: "goodfellas")
- `type` ‚Üí Menyimpan tipe pencarian ("movie" atau "tv")
- `page` ‚Üí Untuk pagination, default halaman 1
- `totalPages` ‚Üí Akan diisi dari response API

---

<a name="membuat-fungsi-search"></a>
## üîç Membuat Fungsi Search

### Memanggil Fungsi Search Saat Halaman Dimuat

Kita perlu memodifikasi fungsi `init()` agar memanggil fungsi `search()` ketika halaman `search.html` dimuat.

**Kode Sebelum:**
```javascript
function init() {
  switch (global.currentPage) {
    case '/':
    case '/index.html':
      displaySlider();
      displayPopularMovies();
      break;
    case '/shows.html':
      displayPopularShows();
      break;
    case '/movie-details.html':
      displayMovieDetails();
      break;
    case '/tv-details.html':
      displayShowDetails();
      break;
    case '/search.html':
      console.log('Search'); // ‚ùå Hanya console.log
      break;
  }

  highlightActiveLink();
}
```

**Kode Sesudah:** üéâ
```javascript
function init() {
  switch (global.currentPage) {
    case '/':
    case '/index.html':
      displaySlider();
      displayPopularMovies();
      break;
    case '/shows.html':
      displayPopularShows();
      break;
    case '/movie-details.html':
      displayMovieDetails();
      break;
    case '/tv-details.html':
      displayShowDetails();
      break;
    case '/search.html':
      search(); // ‚ú® PANGGIL FUNGSI SEARCH
      break;
  }

  highlightActiveLink();
}
```

### Membuat Fungsi Search (Async)

Tambahkan fungsi `search()` di bagian atas file, sebelum fungsi `displaySlider()`.

```javascript
// ‚ú® FUNGSI BARU
// Search Movies/Shows
async function search() {
  // Kode akan ditambahkan bertahap
}
```

**Catatan:** 
- Fungsi dibuat `async` karena akan melakukan API request
- Fungsi ini akan otomatis dipanggil saat user masuk ke `search.html`

---

<a name="mengambil-data-dari-url"></a>
## üì• Mengambil Data dari URL

### Langkah 1: Mendapatkan Query String

Query string adalah semua karakter setelah tanda `?` di URL.

```javascript
async function search() {
  // üîπ Ambil query string dari URL
  const queryString = window.location.search;
  console.log(queryString); // Output: ?type=movie&search-term=goodfellas
}
```

**Penjelasan:**
- `window.location.search` ‚Üí Mengembalikan query string lengkap termasuk `?`
- Contoh output: `?type=movie&search-term=goodfellas`

### Langkah 2: Menggunakan URLSearchParams

`URLSearchParams` adalah API JavaScript untuk memparse query string menjadi object yang mudah diakses.

```javascript
async function search() {
  const queryString = window.location.search;
  
  // üîπ Parse query string dengan URLSearchParams
  const urlParams = new URLSearchParams(queryString);
  
  console.log(urlParams); // URLSearchParams object
}
```

### Langkah 3: Mengambil Nilai dari URLSearchParams

Gunakan method `.get()` untuk mengambil nilai berdasarkan key.

```javascript
async function search() {
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  
  // üîπ Ambil nilai dan simpan ke global state
  global.search.type = urlParams.get('type');
  global.search.term = urlParams.get('search-term');
  
  console.log(global.search.type); // Output: "movie" atau "tv"
  console.log(global.search.term); // Output: "goodfellas"
}
```

**Penjelasan:**
- `urlParams.get('type')` ‚Üí Mengambil value dari `type` (movie/tv)
- `urlParams.get('search-term')` ‚Üí Mengambil value dari `search-term`
- Nilai disimpan langsung ke `global.search` agar bisa diakses dari fungsi lain

**Kenapa Menggunakan 'search-term'?**

Karena di `index.html`, input memiliki attribute:
```html
<input type="text" name="search-term" id="search-term" placeholder="Enter search term" />
```

Attribute `name="search-term"` inilah yang menentukan key di query string.

---

<a name="membuat-custom-alert"></a>
## üö® Membuat Custom Alert

### Mengapa Custom Alert?

JavaScript `alert()` default terlihat kurang menarik. Kita akan membuat alert custom dengan styling yang sudah ada di CSS.

**CSS yang sudah tersedia:**
```css
.alert {
  background: red;
  color: white;
  padding: 10px 20px;
  margin-bottom: 20px;
  border-radius: 5px;
}
```

### Membuat Fungsi showAlert()

Tambahkan fungsi ini di bagian bawah file, sebelum `addCommasToNumber()`.

```javascript
// ‚ú® FUNGSI BARU
// Show Alert
function showAlert(message, className) {
  // 1Ô∏è‚É£ Buat element div
  const alertEl = document.createElement('div');
  
  // 2Ô∏è‚É£ Tambahkan class 'alert' dan class custom
  alertEl.classList.add('alert', className);
  
  // 3Ô∏è‚É£ Tambahkan text message
  alertEl.appendChild(document.createTextNode(message));
  
  // 4Ô∏è‚É£ Tambahkan ke DOM (div#alert di HTML)
  document.querySelector('#alert').appendChild(alertEl);
  
  // 5Ô∏è‚É£ Hapus alert setelah 3 detik
  setTimeout(() => alertEl.remove(), 3000);
}
```

**Penjelasan Step by Step:**

1. **`document.createElement('div')`**
   - Membuat element `<div>` baru

2. **`alertEl.classList.add('alert', className)`**
   - Menambahkan 2 class sekaligus
   - `'alert'` ‚Üí Class default untuk styling
   - `className` ‚Üí Class tambahan (misalnya 'error', 'success')

3. **`document.createTextNode(message)`**
   - Membuat text node dari parameter `message`
   - Lebih aman dari XSS attack dibanding `innerHTML`

4. **`document.querySelector('#alert').appendChild(alertEl)`**
   - Mencari element dengan ID `alert` di HTML
   - Menambahkan alert element ke dalamnya

5. **`setTimeout(() => alertEl.remove(), 3000)`**
   - Menunggu 3000ms (3 detik)
   - Lalu menghapus alert dari DOM dengan `.remove()`

### HTML yang Diperlukan

Pastikan di `index.html` dan `search.html` ada element ini:

```html
<div id="alert"></div>
```

Element ini akan menjadi container untuk alert yang muncul.

---

<a name="validasi-input-search"></a>
## ‚úÖ Validasi Input Search

Sebelum melakukan API request, kita harus memvalidasi apakah user sudah memasukkan search term.

### Menambahkan Validasi di Fungsi search()

```javascript
async function search() {
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);

  global.search.type = urlParams.get('type');
  global.search.term = urlParams.get('search-term');

  // ‚ú® VALIDASI
  if (global.search.term !== '' && global.search.term !== null) {
    // ‚úÖ Jika ada search term, lakukan request
    // TODO: Make request and display results
    const results = await searchAPIData();
    console.log(results);
  } else {
    // ‚ùå Jika tidak ada search term, tampilkan alert
    showAlert('Please enter a search term');
  }
}
```

**Penjelasan Kondisi:**

```javascript
if (global.search.term !== '' && global.search.term !== null)
```

- `global.search.term !== ''` ‚Üí Cek apakah tidak kosong
- `global.search.term !== null` ‚Üí Cek apakah tidak null
- Kedua kondisi harus terpenuhi (operator `&&`)

**Kenapa Perlu Cek null?**

Jika user langsung akses `search.html` tanpa query string, maka `urlParams.get('search-term')` akan return `null`.

---

<a name="memindahkan-api-key-ke-global-state"></a>
## üîë Memindahkan API Key ke Global State

### Mengapa Dipindahkan?

Kita akan membuat 2 fungsi untuk request API:
1. `fetchAPIData()` ‚Üí Untuk endpoint biasa (popular, details, dll)
2. `searchAPIData()` ‚Üí Untuk endpoint search

Agar tidak duplikat kode, kita pindahkan API_KEY dan API_URL ke global state.

### Modifikasi Global State

**Kode Sebelum:**
```javascript
const global = {
  currentPage: window.location.pathname,
  search: {
    term: '',
    type: '',
    page: 1,
    totalPages: 1,
  },
};
```

**Kode Sesudah:** üéâ
```javascript
const global = {
  currentPage: window.location.pathname,
  search: {
    term: '',
    type: '',
    page: 1,
    totalPages: 1,
  },
  // ‚ú® TAMBAHAN BARU
  api: {
    apiKey: '', // Isi dengan API key kamu
    apiUrl: 'https://api.themoviedb.org/3/',
  },
};
```

### Update Fungsi fetchAPIData()

**Kode Sebelum:**
```javascript
async function fetchAPIData(endpoint) {
  const API_KEY = ''; // ‚ùå Hardcoded
  const API_URL = 'https://api.themoviedb.org/3/'; // ‚ùå Hardcoded

  showSpinner();

  const response = await fetch(
    `${API_URL}${endpoint}?api_key=${API_KEY}&language=en-US`
  );

  const data = await response.json();
  hideSpinner();
  return data;
}
```

**Kode Sesudah:** üéâ
```javascript
async function fetchAPIData(endpoint) {
  // ‚ú® GUNAKAN DARI GLOBAL STATE
  const API_KEY = global.api.apiKey;
  const API_URL = global.api.apiUrl;

  showSpinner();

  const response = await fetch(
    `${API_URL}${endpoint}?api_key=${API_KEY}&language=en-US`
  );

  const data = await response.json();
  hideSpinner();
  return data;
}
```

**Keuntungan:**
- ‚úÖ Tidak perlu duplikat API_KEY dan API_URL
- ‚úÖ Mudah maintenance (cukup ubah di 1 tempat)
- ‚úÖ Konsisten di semua fungsi

---

<a name="membuat-fungsi-searchapidata"></a>
## üîé Membuat Fungsi searchAPIData

Fungsi ini khusus untuk melakukan request ke endpoint search API.

### Endpoint Search API

Menurut dokumentasi TMDB API:
- **Search Movies:** `GET /search/movie`
- **Search TV Shows:** `GET /search/tv`

### Membuat Fungsi searchAPIData()

Tambahkan fungsi ini setelah `fetchAPIData()`:

```javascript
// ‚ú® FUNGSI BARU
// Make Request To Search
async function searchAPIData() {
  const API_KEY = global.api.apiKey;
  const API_URL = global.api.apiUrl;

  showSpinner();

  const response = await fetch(
    `${API_URL}search/${global.search.type}?api_key=${API_KEY}&language=en-US&query=${global.search.term}`
  );

  const data = await response.json();

  hideSpinner();

  return data;
}
```

### Penjelasan URL yang Dibuat

Mari kita breakdown URL yang dibentuk:

```javascript
`${API_URL}search/${global.search.type}?api_key=${API_KEY}&language=en-US&query=${global.search.term}`
```

**Jika nilai variabel:**
- `API_URL` = `https://api.themoviedb.org/3/`
- `global.search.type` = `movie`
- `API_KEY` = `your-api-key`
- `global.search.term` = `goodfellas`

**Maka URL lengkapnya:**
```
https://api.themoviedb.org/3/search/movie?api_key=your-api-key&language=en-US&query=goodfellas
```

**Breakdown:**
1. `https://api.themoviedb.org/3/` ‚Üí Base URL
2. `search/movie` ‚Üí Endpoint (bisa `movie` atau `tv`)
3. `?` ‚Üí Penanda query string dimulai
4. `api_key=your-api-key` ‚Üí Parameter API key
5. `&language=en-US` ‚Üí Parameter bahasa
6. `&query=goodfellas` ‚Üí Parameter search term

### Perbedaan dengan fetchAPIData()

| Aspek | fetchAPIData() | searchAPIData() |
|-------|----------------|-----------------|
| **Endpoint** | Dinamis via parameter | Selalu `/search/{type}` |
| **Query Params** | Hanya `api_key` & `language` | Tambahan `query` |
| **Penggunaan** | Popular, details, dll | Hanya untuk search |

---

<a name="testing-hasil-search"></a>
## üß™ Testing Hasil Search

### Test 1: Search dengan Term Valid

**Langkah:**
1. Buka `index.html`
2. Ketik "goodfellas" di search box
3. Pilih "Movies"
4. Klik search

**Hasil di Console:**
```javascript
{
  page: 1,
  results: [
    {
      id: 769,
      title: "GoodFellas",
      original_title: "GoodFellas",
      poster_path: "/...",
      // ... data lainnya
    },
    {
      id: 123456,
      title: "Scorsese's GoodFellas",
      // ... data lainnya
    }
  ],
  total_pages: 1,
  total_results: 2
}
```

**Penjelasan Response:**
- `page` ‚Üí Halaman saat ini (untuk pagination)
- `results` ‚Üí Array berisi hasil pencarian (max 20 per page)
- `total_pages` ‚Üí Total halaman yang tersedia
- `total_results` ‚Üí Total hasil yang ditemukan

### Test 2: Search dengan Term Umum

**Langkah:**
1. Ketik "orphan" di search box
2. Klik search

**Hasil di Console:**
```javascript
{
  page: 1,
  results: [ /* 20 items */ ],
  total_pages: 9,
  total_results: 162
}
```

**Analisis:**
- Keyword "orphan" lebih umum
- Ditemukan 162 hasil total
- Dibagi menjadi 9 halaman (20 hasil per halaman)
- Response hanya menampilkan 20 hasil pertama

### Test 3: Search Tanpa Input (Validasi)

**Langkah:**
1. Langsung klik search tanpa mengisi apapun
2. Atau akses langsung `search.html` tanpa query string

**Hasil:**
- ‚úÖ Alert muncul: "Please enter a search term"
- ‚úÖ Alert hilang otomatis setelah 3 detik
- ‚ùå Tidak ada API request yang dilakukan

---

<a name="kode-lengkap"></a>
## üìù Kode Lengkap

### File: script.js (Versi Final)

```javascript
const global = {
  currentPage: window.location.pathname,
  search: {
    term: '',
    type: '',
    page: 1,
    totalPages: 1,
  },
  api: {
    apiKey: '', // ‚ö†Ô∏è ISI DENGAN API KEY KAMU
    apiUrl: 'https://api.themoviedb.org/3/',
  },
};

// Display 20 most popular movies
async function displayPopularMovies() {
  const { results } = await fetchAPIData('movie/popular');

  results.forEach((movie) => {
    const div = document.createElement('div');
    div.classList.add('card');
    div.innerHTML = `
          <a href="movie-details.html?id=${movie.id}">
            ${
              movie.poster_path
                ? `<img
              src="https://image.tmdb.org/t/p/w500${movie.poster_path}"
              class="card-img-top"
              alt="${movie.title}"
            />`
                : `<img
            src="../images/no-image.jpg"
            class="card-img-top"
            alt="${movie.title}"
          />`
            }
          </a>
          <div class="card-body">
            <h5 class="card-title">${movie.title}</h5>
            <p class="card-text">
              <small class="text-muted">Release: ${movie.release_date}</small>
            </p>
          </div>
        `;

    document.querySelector('#popular-movies').appendChild(div);
  });
}

// Display 20 most popular tv shows
async function displayPopularShows() {
  const { results } = await fetchAPIData('tv/popular');

  results.forEach((show) => {
    const div = document.createElement('div');
    div.classList.add('card');
    div.innerHTML = `
          <a href="tv-details.html?id=${show.id}">
            ${
              show.poster_path
                ? `<img
              src="https://image.tmdb.org/t/p/w500${show.poster_path}"
              class="card-img-top"
              alt="${show.name}"
            />`
                : `<img
            src="../images/no-image.jpg"
            class="card-img-top"
            alt="${show.name}"
          />`
            }
          </a>
          <div class="card-body">
            <h5 class="card-title">${show.name}</h5>
            <p class="card-text">
              <small class="text-muted">Air Date: ${show.first_air_date}</small>
            </p>
          </div>
        `;

    document.querySelector('#popular-shows').appendChild(div);
  });
}

// Display Movie Details
async function displayMovieDetails() {
  const movieId = window.location.search.split('=')[1];

  const movie = await fetchAPIData(`movie/${movieId}`);

  // Overlay for background image
  displayBackgroundImage('movie', movie.backdrop_path);

  const div = document.createElement('div');

  div.innerHTML = `
  <div class="details-top">
  <div>
  ${
    movie.poster_path
      ? `<img
    src="https://image.tmdb.org/t/p/w500${movie.poster_path}"
    class="card-img-top"
    alt="${movie.title}"
  />`
      : `<img
  src="../images/no-image.jpg"
  class="card-img-top"
  alt="${movie.title}"
/>`
  }
  </div>
  <div>
    <h2>${movie.title}</h2>
    <p>
      <i class="fas fa-star text-primary"></i>
      ${movie.vote_average.toFixed(1)} / 10
    </p>
    <p class="text-muted">Release Date: ${movie.release_date}</p>
    <p>
      ${movie.overview}
    </p>
    <h5>Genres</h5>
    <ul class="list-group">
      ${movie.genres.map((genre) => `<li>${genre.name}</li>`).join('')}
    </ul>
    <a href="${
      movie.homepage
    }" target="_blank" class="btn">Visit Movie Homepage</a>
  </div>
</div>
<div class="details-bottom">
  <h2>Movie Info</h2>
  <ul>
    <li><span class="text-secondary">Budget:</span> $${addCommasToNumber(
      movie.budget
    )}</li>
    <li><span class="text-secondary">Revenue:</span> $${addCommasToNumber(
      movie.revenue
    )}</li>
    <li><span class="text-secondary">Runtime:</span> ${
      movie.runtime
    } minutes</li>
    <li><span class="text-secondary">Status:</span> ${movie.status}</li>
  </ul>
  <h4>Production Companies</h4>
  <div class="list-group">
    ${movie.production_companies
      .map((company) => `<span>${company.name}</span>`)
      .join(', ')}
  </div>
</div>
  `;

  document.querySelector('#movie-details').appendChild(div);
}

// Display Show Details
async function displayShowDetails() {
  const showId = window.location.search.split('=')[1];

  const show = await fetchAPIData(`tv/${showId}`);

  // Overlay for background image
  displayBackgroundImage('tv', show.backdrop_path);

  const div = document.createElement('div');

  div.innerHTML = `
  <div class="details-top">
  <div>
  ${
    show.poster_path
      ? `<img
    src="https://image.tmdb.org/t/p/w500${show.poster_path}"
    class="card-img-top"
    alt="${show.name}"
  />`
      : `<img
  src="../images/no-image.jpg"
  class="card-img-top"
  alt="${show.name}"
/>`
  }
  </div>
  <div>
    <h2>${show.name}</h2>
    <p>
      <i class="fas fa-star text-primary"></i>
      ${show.vote_average.toFixed(1)} / 10
    </p>
    <p class="text-muted">Last Air Date: ${show.last_air_date}</p>
    <p>
      ${show.overview}
    </p>
    <h5>Genres</h5>
    <ul class="list-group">
      ${show.genres.map((genre) => `<li>${genre.name}</li>`).join('')}
    </ul>
    <a href="${
      show.homepage
    }" target="_blank" class="btn">Visit show Homepage</a>
  </div>
</div>
<div class="details-bottom">
  <h2>Show Info</h2>
  <ul>
    <li><span class="text-secondary">Number of Episodes:</span> ${
      show.number_of_episodes
    }</li>
    <li><span class="text-secondary">Last Episode To Air:</span> ${
      show.last_episode_to_air.name
    }</li>
    <li><span class="text-secondary">Status:</span> ${show.status}</li>
  </ul>
  <h4>Production Companies</h4>
  <div class="list-group">
    ${show.production_companies
      .map((company) => `<span>${company.name}</span>`)
      .join(', ')}
  </div>
</div>
  `;

  document.querySelector('#show-details').appendChild(div);
}

// Display Backdrop On Details Pages
function displayBackgroundImage(type, backgroundPath) {
  const overlayDiv = document.createElement('div');
  overlayDiv.style.backgroundImage = `url(https://image.tmdb.org/t/p/original/${backgroundPath})`;
  overlayDiv.style.backgroundSize = 'cover';
  overlayDiv.style.backgroundPosition = 'center';
  overlayDiv.style.backgroundRepeat = 'no-repeat';
  overlayDiv.style.height = '100vh';
  overlayDiv.style.width = '100vw';
  overlayDiv.style.position = 'absolute';
  overlayDiv.style.top = '0';
  overlayDiv.style.left = '0';
  overlayDiv.style.zIndex = '-1';
  overlayDiv.style.opacity = '0.1';

  if (type === 'movie') {
    document.querySelector('#movie-details').appendChild(overlayDiv);
  } else {
    document.querySelector('#show-details').appendChild(overlayDiv);
  }
}

// ‚ú® FUNGSI BARU: Search Movies/Shows
async function search() {
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);

  global.search.type = urlParams.get('type');
  global.search.term = urlParams.get('search-term');

  if (global.search.term !== '' && global.search.term !== null) {
    const results = await searchAPIData();
    console.log(results);
  } else {
    showAlert('Please enter a search term');
  }
}

// Display Slider Movies
async function displaySlider() {
  const { results } = await fetchAPIData('movie/now_playing');

  results.forEach((movie) => {
    const div = document.createElement('div');
    div.classList.add('swiper-slide');

    div.innerHTML = `
      <a href="movie-details.html?id=${movie.id}">
        <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}" />
      </a>
      <h4 class="swiper-rating">
        <i class="fas fa-star text-secondary"></i> ${movie.vote_average} / 10
      </h4>
    `;

    document.querySelector('.swiper-wrapper').appendChild(div);

    initSwiper();
  });
}

function initSwiper() {
  const swiper = new Swiper('.swiper', {
    slidesPerView: 1,
    spaceBetween: 30,
    freeMode: true,
    loop: true,
    autoplay: {
      delay: 4000,
      disableOnInteraction: false,
    },
    breakpoints: {
      500: {
        slidesPerView: 2,
      },
      700: {
        slidesPerView: 3,
      },
      1200: {
        slidesPerView: 4,
      },
    },
  });
}

// ‚ú® UPDATE: Fetch data from TMDB API
async function fetchAPIData(endpoint) {
  const API_KEY = global.api.apiKey; // ‚ú® Ambil dari global state
  const API_URL = global.api.apiUrl; // ‚ú® Ambil dari global state

  showSpinner();

  const response = await fetch(
    `${API_URL}${endpoint}?api_key=${API_KEY}&language=en-US`
  );

  const data = await response.json();

  hideSpinner();

  return data;
}

// ‚ú® FUNGSI BARU: Make Request To Search
async function searchAPIData() {
  const API_KEY = global.api.apiKey;
  const API_URL = global.api.apiUrl;

  showSpinner();

  const response = await fetch(
    `${API_URL}search/${global.search.type}?api_key=${API_KEY}&language=en-US&query=${global.search.term}`
  );

  const data = await response.json();

  hideSpinner();

  return data;
}

// ‚ú® FUNGSI BARU: Show Alert
function showAlert(message, className) {
  const alertEl = document.createElement('div');
  alertEl.classList.add('alert', className);
  alertEl.appendChild(document.createTextNode(message));
  document.querySelector('#alert').appendChild(alertEl);

  setTimeout(() => alertEl.remove(), 3000);
}

function showSpinner() {
  document.querySelector('.spinner').classList.add('show');
}

function hideSpinner() {
  document.querySelector('.spinner').classList.remove('show');
}

// Highlight active link
function highlightActiveLink() {
  const links = document.querySelectorAll('.nav-link');
  links.forEach((link) => {
    if (link.getAttribute('href') === global.currentPage) {
      link.classList.add('active');
    }
  });
}

function addCommasToNumber(number) {
  return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

// ‚ú® UPDATE: Init App
function init() {
  switch (global.currentPage) {
    case '/':
    case '/index.html':
      displaySlider();
      displayPopularMovies();
      break;
    case '/shows.html':
      displayPopularShows();
      break;
    case '/movie-details.html':
      displayMovieDetails();
      break;
    case '/tv-details.html':
      displayShowDetails();
      break;
    case '/search.html':
      search(); // ‚ú® Panggil fungsi search
      break;
  }

  highlightActiveLink();
}

document.addEventListener('DOMContentLoaded', init);
```

---

## üéì Kesimpulan

Dalam tutorial ini, kita telah belajar:

‚úÖ **Konsep URL Query String** - Memahami bagaimana data dikirim via URL  
‚úÖ **URLSearchParams API** - Cara parse dan mengambil data dari query string  
‚úÖ **Global State Management** - Menyimpan data search di global object  
‚úÖ **Custom Alert** - Membuat notifikasi custom dengan styling  
‚úÖ **Validasi Input** - Memastikan user mengisi form dengan benar  
‚úÖ **Search API Request** - Melakukan request ke endpoint search TMDB  
‚úÖ **Code Organization** - Memisahkan fungsi fetchAPIData dan searchAPIData  

### üìå Yang Perlu Diingat

1. **Query String** dimulai dengan `?` dan berisi `key=value` pairs
2. **URLSearchParams** membuat parsing query string jadi mudah
3. **Global state** memudahkan sharing data antar fungsi
4. **Validasi** penting untuk mencegah error dan meningkatkan UX
5. **Custom alert** lebih bagus dari JavaScript `alert()` default

### üöÄ Langkah Selanjutnya

Di video berikutnya, kita akan:
- Menampilkan hasil search di DOM
- Membuat card untuk setiap movie/show
- Menambahkan pagination untuk hasil yang banyak

---

## üìö Referensi

- [MDN - URLSearchParams](https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams)
- [MDN - Window.location](https://developer.mozilla.org/en-US/docs/Web/API/Window/location)
- [TMDB API Documentation](https://developers.themoviedb.org/3)

---

üí° **Tips:** Jangan lupa ganti `apiKey: ''` dengan API key yang sudah kamu daftar di TMDB!
