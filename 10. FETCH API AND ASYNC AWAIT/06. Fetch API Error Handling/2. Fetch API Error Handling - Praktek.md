# ğŸš€ Panduan Lengkap Error Handling dengan Fetch API

> **Dokumentasi Pribadi untuk Pemula** - Belajar menangani error saat melakukan HTTP request dengan Fetch API

---

## ğŸ“‘ Daftar Isi

- [Pengenalan](#pengenalan)
- [Persiapan Project](#persiapan-project)
- [Memahami HTTP Status Code](#memahami-http-status-code)
- [API untuk Testing](#api-untuk-testing)
- [Masalah dengan Fetch API](#masalah-dengan-fetch-api)
  - [Percobaan 1: Request Sukses (200)](#percobaan-1-request-sukses-200)
  - [Percobaan 2: Request Error (404)](#percobaan-2-request-error-404)
  - [Percobaan 3: Network Error](#percobaan-3-network-error)
- [Solusi Error Handling](#solusi-error-handling)
  - [Metode 1: Menggunakan response.ok](#metode-1-menggunakan-responseok)
  - [Metode 2: Cek Status Code Spesifik](#metode-2-cek-status-code-spesifik)
- [Implementasi pada Project Random User](#implementasi-pada-project-random-user)
- [Kesimpulan](#kesimpulan)

---

<a name="pengenalan"></a>
## ğŸ¯ Pengenalan

Ketika kita membuat request HTTP menggunakan Fetch API, tidak selamanya server memberikan response yang kita harapkan. Kadang server mengirimkan error seperti:
- âŒ **404 Not Found** - Resource tidak ditemukan
- âŒ **401 Unauthorized** - Tidak memiliki akses
- âŒ **500 Server Error** - Kesalahan di server

Dokumentasi ini akan mengajarkan cara menangani berbagai jenis error tersebut dengan benar! ğŸ’ª

---

<a name="persiapan-project"></a>
## ğŸ“ Persiapan Project

### Struktur Folder
```
fetch-error-handling/
â”œâ”€â”€ index.html
â””â”€â”€ index.js
```

### 1ï¸âƒ£ Buat file `index.html`

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fetch API Error Handling</title>
  </head>
  <body>
    <h1>Fetch API Error Handling</h1>

    <script src="./index.js"></script>
  </body>
</html>
```

### 2ï¸âƒ£ Buat file `index.js`

File ini akan kita isi bertahap sesuai pembelajaran ğŸ“

---

<a name="memahami-http-status-code"></a>
## ğŸ“Š Memahami HTTP Status Code

Sebelum mulai coding, penting untuk memahami status code yang umum:

| Status Code | Arti | Kategori |
|-------------|------|----------|
| **200** âœ… | OK - Request berhasil | Success |
| **201** âœ… | Created - Resource berhasil dibuat | Success |
| **204** âœ… | No Content - Sukses tapi tidak ada data | Success |
| **301** â†ªï¸ | Moved Permanently - Resource dipindah | Redirect |
| **400** âš ï¸ | Bad Request - Request salah | Client Error |
| **401** ğŸ”’ | Unauthorized - Tidak punya akses | Client Error |
| **403** ğŸš« | Forbidden - Akses ditolak | Client Error |
| **404** â“ | Not Found - Resource tidak ada | Client Error |
| **500** ğŸ’¥ | Internal Server Error - Error di server | Server Error |

> ğŸ’¡ **Tips**: Status code **2xx** = sukses, **4xx** = error client, **5xx** = error server

---

<a name="api-untuk-testing"></a>
## ğŸ§ª API untuk Testing

Untuk belajar error handling, kita membutuhkan API yang bisa kita gunakan untuk testing. Berikut adalah API gratis yang recommended:

### 1ï¸âƒ£ **JSONPlaceholder** â­ (RECOMMENDED)
```
https://jsonplaceholder.typicode.com
```
- âœ… Stabil dan cepat
- âœ… Gratis tanpa API key
- âœ… Bisa test 404 dengan ID yang tidak exist

**Contoh endpoint:**
- `https://jsonplaceholder.typicode.com/posts/1` â†’ Success (200)
- `https://jsonplaceholder.typicode.com/posts/999999` â†’ Not Found (404)
- `https://jsonplaceholder.typicode.com/users/1` â†’ Success (200)

### 2ï¸âƒ£ **ReqRes API**
```
https://reqres.in/api
```
- âœ… Khusus untuk testing
- âœ… Data user dummy
- âœ… Support berbagai HTTP method

### 3ï¸âƒ£ **Random User API**
```
https://randomuser.me/api/
```
- âœ… Generate random user data
- âœ… Bagus untuk project praktis

> ğŸ’¡ **Catatan**: httpstat.us kadang down, jadi kita pakai alternatif yang lebih stabil!

---

<a name="masalah-dengan-fetch-api"></a>
## âš ï¸ Masalah dengan Fetch API

Mari kita lihat masalah yang sering terjadi saat menggunakan Fetch API...

<a name="percobaan-1-request-sukses-200"></a>
### ğŸŸ¢ Percobaan 1: Request Sukses (200)

**Tulis kode berikut di `index.js`:**

```javascript
// Success - Status 200
fetch('https://jsonplaceholder.typicode.com/posts/1')
  .then((response) => {
    console.log('Status:', response.status); // 200
    console.log('OK:', response.ok);         // true
    return response.json();
  })
  .then((data) => {
    console.log('success');
    console.log('Data:', data);
  });
```

**Penjelasan:**
- Kita request ke endpoint yang mengembalikan status 200
- `.then()` pertama menerima response dan convert ke JSON
- `.then()` kedua menampilkan 'success' dan data

**Hasil di Console:**
```
Status: 200
OK: true
success
Data: { userId: 1, id: 1, title: "...", body: "..." }
```

**Ini sudah sesuai harapan!** ğŸ‘

---

<a name="percobaan-2-request-error-404"></a>
### ğŸ”´ Percobaan 2: Request Error (404)

Sekarang coba request ke endpoint yang mengembalikan error 404:

**Tambahkan kode berikut:**

```javascript
// Error 404 - ID tidak exist
fetch('https://jsonplaceholder.typicode.com/posts/999999')
  .then((response) => {
    console.log('Status:', response.status); // 404
    console.log('OK:', response.ok);         // false
    return response.json();
  })
  .then((data) => {
    console.log('success');
    console.log('Data:', data);
  })
  .catch((error) => {
    console.log('Error:', error);
  });
```

**Penjelasan:**
- Request ke endpoint dengan ID yang tidak exist (999999)
- Kita tambahkan `.catch()` untuk menangkap error
- Kita harapkan `.catch()` yang jalan, bukan `.then()`

**Hasil di Console:**
```
Status: 404
OK: false
success
Data: {}
```

**â— MASALAH:** Walaupun status 404 (error), kode tetap jalan ke `.then()` dan menampilkan "success"! Ini tidak benar!

> ğŸš¨ **Penting**: Fetch API **TIDAK** menganggap status error (404, 500, dll) sebagai error yang harus di-catch!

---

<a name="percobaan-3-network-error"></a>
### ğŸŒ Percobaan 3: Network Error

Lalu kapan `.catch()` berjalan? Mari coba request ke URL yang tidak exist:

**Tambahkan kode berikut:**

```javascript
// Network Error - Domain tidak exist
fetch('https://domain-yang-tidak-ada-123456789.com/api')
  .then((response) => {
    return response.json();
  })
  .then((data) => {
    console.log('success');
    console.log('Data:', data);
  })
  .catch((error) => {
    console.log('Error caught:', error.message);
  });
```

**Penjelasan:**
- Request ke domain yang tidak exist
- Browser akan mencoba connect beberapa detik
- Kemudian akan terjadi network error

**Hasil di Console (setelah beberapa detik):**
```
Error caught: Failed to fetch
```

**âœ… KESIMPULAN:** `.catch()` hanya jalan pada **NETWORK ERROR**, bukan pada error status code seperti 404 atau 500!

---

<a name="solusi-error-handling"></a>
## ğŸ’¡ Solusi Error Handling

Karena Fetch API tidak otomatis handle error status, kita harus cek sendiri secara manual!

<a name="metode-1-menggunakan-responseok"></a>
### âœ¨ Metode 1: Menggunakan `response.ok`

Cara paling mudah adalah menggunakan property `response.ok`!

**Tambahkan kode berikut:**

```javascript
// Test with response.ok
fetch('https://jsonplaceholder.typicode.com/posts/999999')
  .then((response) => {
    console.log('Status:', response.status); // 404
    console.log('OK:', response.ok);         // false
    
    // CEK APAKAH RESPONSE OK
    if (!response.ok) {
      throw new Error('Request Failed');
    }
    
    return response.json();
  })
  .then((data) => {
    console.log('success');
    console.log('Data:', data);
  })
  .catch((error) => {
    console.log('Error:', error.message);
  });
```

**Penjelasan:**
1. `response.ok` bernilai `true` jika status dalam range 200-299 âœ…
2. `response.ok` bernilai `false` jika status di luar range tersebut âŒ
3. Jika `!response.ok` (tidak ok), kita `throw new Error()`
4. Error yang di-throw akan ditangkap oleh `.catch()`

**Hasil di Console:**
```
Status: 404
OK: false
Error: Request Failed âœ…
```

**ğŸ‰ Berhasil!** Sekarang `.catch()` berjalan dengan benar!

**Testing dengan status 200:**

Ubah URL menjadi `https://jsonplaceholder.typicode.com/posts/1`, maka hasilnya:
```
Status: 200
OK: true
success
Data: { userId: 1, id: 1, title: "...", body: "..." }
```

> ğŸ’¡ **Tips**: `response.ok` adalah cara **PALING MUDAH** dan **DIREKOMENDASIKAN**!

---

<a name="metode-2-cek-status-code-spesifik"></a>
### ğŸ¯ Metode 2: Cek Status Code Spesifik

Kadang kita ingin memberikan pesan error yang berbeda untuk setiap status code:

**Tambahkan kode berikut:**

```javascript
// Check for specific code
fetch('https://jsonplaceholder.typicode.com/posts/999999')
  .then((response) => {
    // CEK STATUS CODE SPESIFIK
    if (response.status === 404) {
      throw new Error('Not Found - Resource tidak ditemukan');
    } else if (response.status === 500) {
      throw new Error('Server Error - Ada masalah di server');
    } else if (response.status === 401) {
      throw new Error('Unauthorized - Anda tidak memiliki akses');
    } else if (response.status !== 200) {
      throw new Error('Request Failed');
    }
    
    return response.json();
  })
  .then((data) => {
    console.log('success');
    console.log('Data:', data);
  })
  .catch((error) => {
    console.log('Error:', error.message);
  });
```

**Penjelasan:**
1. Cek `response.status === 404` â†’ throw error "Not Found" ğŸ”
2. Cek `response.status === 500` â†’ throw error "Server Error" ğŸ’¥
3. Cek `response.status === 401` â†’ throw error "Unauthorized" ğŸ”’
4. Cek `response.status !== 200` â†’ throw error "Request Failed" âš ï¸
5. Jika lolos semua pengecekan â†’ lanjut ke `.then()` berikutnya âœ…

**Testing dengan berbagai kondisi:**

```javascript
// Test 404
fetch('https://jsonplaceholder.typicode.com/posts/999999')
// Output: Error: Not Found - Resource tidak ditemukan

// Test 200
fetch('https://jsonplaceholder.typicode.com/posts/1')
// Output: success + Data
```

> ğŸ’¡ **Tips**: Gunakan metode ini jika ingin handle setiap status code dengan cara berbeda!

**Properties yang bisa dicek:**

```javascript
console.log(response.status);      // Contoh: 404
console.log(response.ok);          // Contoh: false
console.log(response.statusText);  // Contoh: "Not Found"
```

---

<a name="implementasi-pada-project-random-user"></a>
## ğŸ§‘â€ğŸ’» Implementasi pada Project Random User

Sekarang kita akan implementasikan error handling ke project Random User yang sudah pernah dibuat!

### ğŸ“ File Structure Project

```
random-user-project/
â”œâ”€â”€ index.html
â”œâ”€â”€ style.css
â””â”€â”€ script.js
```

### ğŸ”§ Update Code

Buka file `script.js` dan temukan bagian fetch:

**Kode SEBELUM ditambahkan error handling:**

```javascript
function fetchUser() {
  showSpinner();
  fetch('https://randomuser.me/api')
    .then((res) => res.json())
    .then((data) => {
      hideSpinner();
      displayUser(data.results[0]);
    });
}
```

**âŒ Masalah:** Tidak ada pengecekan error!

---

### âœ… Kode SETELAH ditambahkan error handling:

**Step 1: Tambahkan curly braces dan return pada .then() pertama**

```javascript
function fetchUser() {
  showSpinner();
  fetch('https://randomuser.me/api')
    .then((res) => {
      // Tambahkan curly braces
      return res.json();
    })
    .then((data) => {
      hideSpinner();
      displayUser(data.results[0]);
    });
}
```

**Step 2: Tambahkan pengecekan error**

```javascript
function fetchUser() {
  showSpinner();
  fetch('https://randomuser.me/api')
    .then((res) => {
      // CEK APAKAH RESPONSE OK
      if (!res.ok) {
        throw new Error('Request Failed');
      }
      return res.json();
    })
    .then((data) => {
      hideSpinner();
      displayUser(data.results[0]);
    });
}
```

**Step 3: Tambahkan .catch() untuk handle error**

```javascript
function fetchUser() {
  showSpinner();
  fetch('https://randomuser.me/api')
    .then((res) => {
      if (!res.ok) {
        throw new Error('Request Failed');
      }
      return res.json();
    })
    .then((data) => {
      hideSpinner();
      displayUser(data.results[0]);
    })
    .catch((error) => {
      // HIDE SPINNER SAAT ERROR
      hideSpinner();
      
      // TAMPILKAN ERROR DI UI
      document.querySelector('#user').innerHTML = `
        <p class="text-xl text-red-500 mb-5">
          ${error.message}
        </p>
      `;
    });
}
```

**Penjelasan lengkap:**

1. **Pengecekan Error:**
   ```javascript
   if (!res.ok) {
     throw new Error('Request Failed');
   }
   ```
   - Jika response tidak ok (status di luar 200-299), throw error

2. **Hide Spinner di Catch:**
   ```javascript
   hideSpinner();
   ```
   - Karena sebelum fetch kita `showSpinner()`, maka saat error juga harus `hideSpinner()`

3. **Tampilkan Error di UI:**
   ```javascript
   document.querySelector('#user').innerHTML = `
     <p class="text-xl text-red-500 mb-5">
       ${error.message}
     </p>
   `;
   ```
   - Ambil element dengan id `user`
   - Isi dengan paragraph error berwarna merah
   - Classes Tailwind: `text-xl` (besar), `text-red-500` (merah), `mb-5` (margin bottom)

---

### ğŸ§ª Testing Error Handling

**Test 1: URL Normal (Sukses)**

```javascript
fetch('https://randomuser.me/api') // âœ… Berhasil
```
Hasil: Menampilkan data user seperti biasa

**Test 2: URL Salah (Error 404)**

```javascript
fetch('https://randomuser.me/api123') // âŒ Error 404
```
Hasil: Menampilkan pesan error merah "Request Failed"

**Test 3: Simulasi dengan JSONPlaceholder**

Jika ingin test dengan endpoint yang bisa dikontrol:

```javascript
function fetchUser() {
  showSpinner();
  // Test dengan endpoint 404
  fetch('https://jsonplaceholder.typicode.com/posts/999999')
    .then((res) => {
      if (!res.ok) {
        throw new Error('Data tidak ditemukan (404)');
      }
      return res.json();
    })
    .then((data) => {
      hideSpinner();
      console.log('Data:', data);
    })
    .catch((error) => {
      hideSpinner();
      document.querySelector('#user').innerHTML = `
        <p class="text-xl text-red-500 mb-5">
          ${error.message}
        </p>
      `;
    });
}
```

---

<a name="kesimpulan"></a>
## ğŸ“ Kesimpulan

### ğŸ“Œ Poin-Poin Penting:

1. **Fetch API Tidak Auto-Handle Error Status**
   - Status 404, 500, dll **TIDAK** masuk ke `.catch()`
   - `.catch()` hanya jalan pada **network error**

2. **Cara Handle Error dengan Fetch:**
   
   **Cara 1: Gunakan `response.ok` (RECOMMENDED)** â­
   ```javascript
   if (!response.ok) {
     throw new Error('Request Failed');
   }
   ```
   
   **Cara 2: Cek Status Code Spesifik**
   ```javascript
   if (response.status === 404) {
     throw new Error('Not Found');
   } else if (response.status === 500) {
     throw new Error('Server Error');
   }
   ```

3. **Jangan Lupa `.catch()`**
   ```javascript
   .catch((error) => {
     // Handle error di sini
     console.log(error.message);
   });
   ```

4. **Best Practices:**
   - âœ… Selalu tambahkan error handling pada fetch
   - âœ… Hide loading spinner saat error
   - âœ… Tampilkan pesan error yang jelas ke user
   - âœ… Test dengan berbagai scenario (sukses, 404, 500, network error)

### ğŸ¯ Contoh Lengkap dengan Error Handling:

```javascript
fetch('https://jsonplaceholder.typicode.com/posts/1')
  .then((response) => {
    // Cek error
    if (!response.ok) {
      throw new Error(`HTTP Error: ${response.status}`);
    }
    return response.json();
  })
  .then((data) => {
    console.log('Success:', data);
  })
  .catch((error) => {
    console.error('Error:', error.message);
  });
```

### ğŸš€ Next Steps:

- âœ… Praktek dengan API JSONPlaceholder
- âœ… Tambahkan retry mechanism
- âœ… Implementasi loading state yang lebih baik
- âœ… Pelajari Axios (library yang auto-handle error)

### ğŸ”— API untuk Praktek:

| API | URL | Kegunaan |
|-----|-----|----------|
| JSONPlaceholder | `https://jsonplaceholder.typicode.com` | Testing CRUD |
| Random User | `https://randomuser.me/api` | Generate user data |
| ReqRes | `https://reqres.in/api` | Testing HTTP methods |

---

### ğŸ“š Referensi:

- [MDN Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)
- [JSONPlaceholder](https://jsonplaceholder.typicode.com) - Free Fake API
- [HTTP Status Codes](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status)

---

**Happy Coding! ğŸ’»âœ¨**

> "The only way to learn a new programming language is by writing programs in it." - Dennis Ritchie
